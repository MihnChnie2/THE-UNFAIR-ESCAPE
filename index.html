<!-- 
  THE UNFAIR ESCAPE - CrazyGames Version
  Th√™m ƒëo·∫°n code n√†y v√†o ƒë·∫ßu file unfair_escape.html (sau <body>)
-->

<script>
// ================================================================
//  CRAZYGAMES SDK INTEGRATION
// ================================================================

// G·ª≠i s·ª± ki·ªán ƒë·∫øn CrazyGames parent
function sendGameEvent(eventType, data = {}) {
  if(window.parent !== window) {
    window.parent.postMessage({
      type: 'gameEvent',
      event: eventType,
      data: data
    }, '*');
  }
}

// Override c√°c h√†m quan tr·ªçng ƒë·ªÉ b√°o c√°o s·ª± ki·ªán

// B√°o khi game b·∫Øt ƒë·∫ßu
const originalGameStart = function() {
  console.log('üì¢ Sending gameStart event');
  sendGameEvent('gameStart');
};

// B√°o khi ho√†n th√†nh level
const originalLevelDone = levelDone;
levelDone = function() {
  sendGameEvent('levelComplete', {level: G.lv, time: G.totalT});
  originalLevelDone.call(this);
};

// B√°o khi game over
const originalGameOver = function() {
  console.log('üì¢ Sending gameOver event');
  sendGameEvent('gameOver', {deaths: G.deaths, level: G.lv});
};

// G·∫Øn event khi show Game Over screen
const originalShow = show;
show = function(screenId) {
  originalShow(screenId);
  if(screenId === 's-go') {
    originalGameOver();
  }
};

// B√°o khi b·∫Øt ƒë·∫ßu ch∆°i (sau khi v√†o game)
const originalParseMap = parseMap;
parseMap = function(lvIdx) {
  originalParseMap(lvIdx);
  if(lvIdx === 0) {
    // L·∫ßn ƒë·∫ßu v√†o game
    sendGameEvent('gameStart');
  }
};

console.log('‚úÖ CrazyGames Integration Ready');
</script>
